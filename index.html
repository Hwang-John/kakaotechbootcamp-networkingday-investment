<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>카카오테크 부트캠프 투자 프로그램</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

   <!-- 가장 상단의 이미지 및 텍스트 섹션 -->
    <header class="main-header">
        <img src="https://hwang-john.github.io/image/%EC%B9%B4%ED%85%8C%EB%B6%80%20%EB%A1%9C%EA%B3%A0.png" alt="업로드한 이미지" class="header-image" />
                <img src="https://hwang-john.github.io/image/ChatGPT%20Image%202026%EB%85%84%201%EC%9B%94%2028%EC%9D%BC%20%EC%98%A4%ED%9B%84%2005_24_03.png" alt="업로드한 이미지" class="header-image2" />
        <h1 class="header-title">
          카카오테크 부트캠프 네트워킹 데이 <br>
          기업가 정신 프로그램<br>
          투자 시뮬레이션 게임🚀
        </h1>
    </header>

<nav class="navbar">
  <a href="index.html">홈</a>
  <a href="admin.html">관리자</a>
</nav>

<h2>투자자 이름 입력</h2>
<input id="username" placeholder="이름 입력" />
<button id="startBtn">시작하기</button>

<hr />

<div id="progressBar">
  <div></div>
</div>
<div class="progress-labels">
  <span id="startLabel">0원</span>
  <span id="currentValue">10,000,000원</span>
  <span id="endLabel">10,000,000원</span>
</div>

<h3 id="money"></h3>

<h2>팀 리스트</h2>
<div id="teams"></div>

<script type="module">
import { db } from "./firebase.js";
import {
  doc, setDoc, getDoc,
  collection, onSnapshot
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const startBtn = document.getElementById("startBtn");
const usernameInput = document.getElementById("username");
const moneyEl = document.getElementById("money");
const teamsEl = document.getElementById("teams");

const userName = localStorage.getItem("user");

// 1️⃣ 사용자 생성
startBtn.onclick = async () => {
  const name = usernameInput.value.trim();
  if (!name) return alert("이름 입력");

  try {
    // 기존 사용자 확인
    const userDoc = await getDoc(doc(db, "users", name));
    if (userDoc.exists()) {
      // 이미 존재하는 사용자는 로그인만
      localStorage.setItem("user", name);
      location.reload();
      return;
    }

    // 새 사용자 생성
    await setDoc(doc(db, "users", name), {
      name,
      remainingMoney: 10000000,
      createdAt: new Date()
    });

    localStorage.setItem("user", name);
    location.reload();
  } catch (error) {
    console.error("사용자 생성 오류:", error);
    alert("사용자 생성 중 오류가 발생했습니다");
  }
};

// 2️⃣ 남은 투자금 표시
async function loadMoney() {
  if (!userName) return;

  try {
    const snap = await getDoc(doc(db, "users", userName));
    if (snap.exists()) {
      const userData = snap.data();
      const remainingMoney = userData.remainingMoney || 0;
      moneyEl.innerText = `남은 투자금: ${remainingMoney.toLocaleString()}원`;

      // ✅ 프로그레스 바 진행률 계산
      const progressBar = document.querySelector("#progressBar div");
      const progress = (remainingMoney / 10000000) * 100; // 진행률 계산
      progressBar.style.width = `${progress}%`;

      // ✅ 현재 남은 금액 업데이트 및 위치 조정
      const currentValueEl = document.getElementById("currentValue");
      currentValueEl.innerText = `${remainingMoney.toLocaleString()}원`;
      
      // position을 동적으로 계산 (가운데 위치)
      const progressBarElement = document.getElementById("progressBar");
      const barWidth = progressBarElement.offsetWidth; // 프로그레스 바의 전체 길이
      const updatedLeft = (progress / 100) * barWidth; // 진행률에 따라 위치 계산
      currentValueEl.style.left = `${updatedLeft}px`; // 현재값 위치 업데이트
    } else {
      localStorage.removeItem("user");
      location.reload();
    }
  } catch (error) {
    console.error("투자금 로드 오류:", error);
    moneyEl.innerText = "투자금 정보를 불러올 수 없습니다";
  }
}

// 3️⃣ 팀 리스트 실시간 표시
onSnapshot(collection(db, "teams"), snapshot => {
  teamsEl.innerHTML = "";
  snapshot.forEach(docu => {
    const team = docu.data();
    const totalInvestment = team.totalInvestment || 0;
    teamsEl.innerHTML += `
      <div style="border:1px solid #ccc; margin:10px; padding:10px"
           onclick="location.href='team.html?id=${docu.id}'">
        <b>${team.name}</b><br/>
        총 투자금: ${totalInvestment.toLocaleString()}원
      </div>
    `;
  });
});

loadMoney();
</script>

</body>
</html>
